from main_test import init, update
from drone import Drone
from car import Car
import time, datetime

car_data = ["0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","0/1/1/1.0","1.4/1/1/2.4","1.4/1/1/3.8","1.4/1/1/5.2","1.4/1/1/6.6","1.4/1/1/8.0","1.4/1/1/9.4","1.4/1/1/10.8","1.4/1/1/12.2","1.4/1/1/13.6","1.4/1/1/15.0","1.4/1/1/16.4","1.4/1/1/17.8","1.4/1/1/19.2","1.4/1/1/20.6","1.4/1/1/22.0","1.4/1/1/23.4","1.4/1/1/24.8","1.4/1/1/26.2","1.4/1/1/27.6","1.4/1/1/29.0","1.4/1/1/30.4","2.5/1/1/32.9","2.5/1/1/35.4","2.5/1/1/37.9","2.5/1/1/40.4","2.5/1/1/42.9","2.5/1/1/45.4","2.5/1/1/47.9","2.5/1/1/50.4","2.5/1/1/52.9","2.5/1/1/55.4","2.5/1/1/57.9","2.5/1/1/60.4","2.5/1/1/62.9","2.5/1/1/65.4","2.5/1/1/67.9","2.5/1/1/70.4","2.5/1/1/72.9","2.5/1/1/75.4","2.5/1/1/77.9","2.5/1/1/80.4","2.5/1/1/82.9","2.5/1/1/85.4","2.5/1/1/87.9","2.5/1/1/90.4","2.5/1/1/92.9","2.5/1/1/95.4","2.5/1/1/97.9","2.5/1/1/100.4","2.5/1/1/102.9","2.5/1/1/105.4","2.5/1/1/107.9","2.5/1/1/110.4","2.5/1/1/112.9","2.5/1/1/115.4","2.5/1/1/117.9","2.5/1/1/120.4","2.5/1/1/122.9","2.5/1/1/125.4","2.5/1/1/127.9","2.5/1/1/130.4","2.5/4/1/2.5","2.5/4/1/5.0","2.5/4/1/7.5","2.5/4/1/10.0","2.5/4/1/12.5","2.5/4/1/15.0","2.5/4/1/17.5","2.5/4/1/20.0","2.5/4/1/22.5","2.5/4/1/25.0","2.5/4/1/27.5","2.5/4/1/30.0","2.5/4/1/32.5","2.5/4/1/35.0","2.5/4/1/37.5","2.5/4/1/40.0"]
	

def init_make_logfile(num):
    title = "{} logfile.txt".format(num)
    with open( title, "w") as file:
        file.write("time,car_road_id,car_speed,car_dist,drone_road_id,drone_speed,drone_target_speed,drone_dist,distance\n")

def add_logfile(data, num):
    title = "{} logfile.txt".format(num)
    with open(title, "a") as file:
        file.write(data)

drone = Drone()
car = Car()
pre_car_road_id = car.road_id
starttime = time.time()

init(drone)

print("DRONE INIT SETTING DONE")

car_idx = 0

roadMap = {1: [[1, 1, 35.1554345, 128.1040969, 7.0], [1, 2, 35.1543852, 128.1045824, 7.0]],
            2: [[2, 1, 35.1543528, 128.1045948, 7.0], [2, 2, 35.1541135, 128.1047038, 7.0]],
            3: [[3, 1, 35.1543841, 128.1046156, 7.0], [3, 2, 35.1544301, 128.1048282, 7.0]],
            4: [[4, 1, 35.1543704, 128.1045506, 7.0], [4, 2, 35.1542914, 128.1041778, 7.0]],
            5: [[5, 1, 35.1544608, 128.10485, 7.0], [5, 2, 35.1547827, 128.1046528, 7.0]],
            6: [[6, 1, 35.1544513, 128.1048989, 7.0], [6, 2, 35.1544798, 128.1050029, 7.0]],
            7: [[7, 1, 35.1544175, 128.1048654, 7.0], [7, 2, 35.1542509, 128.1049486, 7.0]]}
    
current_time = datetime.datetime.now()
formatted_time = current_time.strftime("%Y-%m-%d %H:%M:%S")

init_make_logfile(formatted_time)

while True:
    if car_idx >= len(car_data):
        break

    msg = car_data[car_idx]

    pre_car_road_id = update(msg, roadMap, car, drone, pre_car_road_id)
    
    car_idx += 1

    update_time = time.time()
    
    log_data = "{},{},{},{},{},{},{},{},{}\n".format(
    update_time-starttime,
    car.road_id,
    car.speed,
    car.dist,
    drone.road_id,
    drone.speed,
    drone.target_speed,
    drone.dist,
    drone.dist_drone_car)

    add_logfile(log_data, formatted_time)

    time.sleep(1)    

